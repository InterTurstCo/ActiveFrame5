<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<configuration xmlns="https://cm5.intertrust.ru/config">

    <dynamic-group name="ManagementChain">
        <context>
            <domain-object type="Department" />
        </context>
        <members>
            <collector class-name="ru.intertrust.cm.test.acess.dynamicgroup.ManagementChain" />
        </members>
    </dynamic-group>

    <dynamic-group name="EmployeeBosses">
        <context>
            <domain-object type="Employee" />
        </context>
        <members>
            <collector class-name="ru.intertrust.cm.test.acess.dynamicgroup.EmployeeBosses" />
        </members>
    </dynamic-group>

    <context-role name="AllUsers">
        <context>
            <domain-object type="Person" />
        </context>
        <groups>
            <collector class-name="ru.intertrust.cm.test.acess.contextrole.AllUsers" />
        </groups>
    </context-role>

    <!-- Динамическая группа для тестов  -->
    <dynamic-group name="AllPersonsExceptPerson2">
        <context>
            <domain-object type="Person" />
        </context>
        <members>
            <track-domain-objects type="Person">
                <get-person>
                    <query>select p.id from person p where p.login not in ('person2')</query>
                </get-person>
            </track-domain-objects>
        </members>
    </dynamic-group>
        
	<context-role name="test_outgoing_author">
        <context>
            <domain-object type="test_outgoing_document" />
        </context>
        <groups>
            <track-domain-objects>
                <get-group name="PersonAndDelegates">
                    <doel>author</doel>
                </get-group>
            </track-domain-objects>
        </groups>
    </context-role>    

	<context-role name="test_outgoing_signer">
        <context>
            <domain-object type="test_outgoing_document" />
        </context>
        <groups>
            <track-domain-objects>
                <get-group name="PersonAndDelegates">
                    <doel>signer</doel>
                </get-group>
            </track-domain-objects>
        </groups>
    </context-role>    
    
    <context-role name="test4_employee">
        <context>
            <domain-object type="test_type_4" />
        </context>
        <groups>
            <track-domain-objects>
                <get-group name="Person">
                    <doel>employee</doel>
                </get-group>
            </track-domain-objects>
        </groups>
    </context-role>

    <access-matrix type="test_outgoing_document">
        <status name="Active">
            <read>
                <permit-role name="test_outgoing_author" />
                <permit-role name="test_outgoing_signer" />
            </read>
            <write>
                <permit-role name="test_outgoing_author" />
                <permit-role name="test_outgoing_signer" />
            </write>
            <delete>
                <permit-role name="test_outgoing_author" />
                <permit-role name="test_outgoing_signer" />
            </delete>
        </status>
    </access-matrix>

    <access-matrix type="test_resolution" matrix-reference-field="document"/>

    <access-matrix type="department_test">
        <create>
            <permit-group name="AllPersons" />
        </create>            
        <status name="Active">
            <read>
                <permit-group name="AllPersons" />
            </read>
            <write>
                <permit-group name="AllPersons" />
            </write>
            <delete>
                <permit-group name="AllPersons" />
            </delete>

            <execute-action name="action1">
                <permit-group name="AllPersons" />
            </execute-action>            
        </status>
    </access-matrix>

    <access-matrix type="organization_test">
         <create>
            <permit-group name="AllPersons" />
        </create>        
        <status name="Active">
            <read>
                <permit-group name="AllPersons" />
            </read>
            <create-child type="department_test">
                <permit-group name="AllPersons" />
            </create-child>            
        </status>
    </access-matrix>

<access-matrix type="city_test">
        <create>
            <permit-group name="AllPersons" />
        </create>            
        <status name="Active">
            <read>
                <permit-group name="AllPersonsExceptPerson2" />
            </read>
            <write>
                <permit-group name="AllPersonsExceptPerson2" />
            </write>
            <delete>
                <permit-group name="AllPersonsExceptPerson2" />
            </delete>

            <execute-action name="action1">
                <permit-group name="AllPersonsExceptPerson2" />
            </execute-action>            
        </status>
    </access-matrix>

    <access-matrix type="country_test">
         <create>
            <permit-group name="AllPersons" />
        </create>        
        <status name="Active">
            <read>
                <permit-group name="AllPersons" />
            </read>
            <create-child type="city_test">
                <permit-group name="AllPersonsExceptPerson2" />
            </create-child>            
        </status>
    </access-matrix>
    
    <access-matrix type="employee_test" matrix-reference-field="Department"/>

    <access-matrix type="test_type_1" read-everybody="true"/>

    <access-matrix type="test_type_2" matrix-reference-field="test_type_1"/>

    <access-matrix type="test_type_4" read-everybody="true"/>

    <access-matrix type="test_type_5" read-everybody="true"/>
    
</configuration>