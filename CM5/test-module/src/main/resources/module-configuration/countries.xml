<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<configuration xmlns="https://cm5.intertrust.ru/config"
               xmlns:act="https://cm5.intertrust.ru/config/action">
    <domain-object-type name="country" initial-status="Active">
        <fields>
            <string name="name" length="128"/>
            <string name="short_name" length="128"/>
            <date-time name="independence_day"/>
            <long name="population"/>
            <boolean name="is_country_rich"/>
            <decimal name="square" precision="15" scale="2"/>
            <reference name="capital" type="city">
                <constraints>
                    <simple-constraint value="not-empty"/>
                </constraints>
            </reference>
            <reference name="most_famous_city" type="city"/>
            <reference name="country_union" type="country_union"/>
            <string name="description" length="1024"/>
        </fields>
        <uniqueKey>
            <field name="name"/>
        </uniqueKey>
        <attachment-types>
            <attachment-type name="country_attachment"/>
        </attachment-types>
    </domain-object-type>

    <domain-object-type name="superCountry" initial-status="Active" extends="country"/>

    <domain-object-type name="country_best_friend" initial-status="Active">
        <fields>
            <reference name="country" type="country"/>
            <reference name="best_friend" type="country"/>
            <reference name="description" type="c_best_friend_desc"/>
        </fields>
        <uniqueKey>
            <field name="country"/>
        </uniqueKey>

    </domain-object-type>

    <domain-object-type name="c_best_friend_desc">
        <fields>
            <string name="text" length="100"/>
        </fields>
    </domain-object-type>

    <domain-object-type name="c_best_friend_desc_back">
        <fields>
            <reference name="country_best_friend" type="country_best_friend"/>
            <string name="text" length="100"/>
        </fields>
    </domain-object-type>

    <domain-object-type name="super_country" extends="country" initial-status="Active">
        <fields>
            <string name="additional_name" length="128"/>
        </fields>
    </domain-object-type>

    <domain-object-type name="super_city" extends="city">
        <fields>
            <string name="additional_name" length="128"/>
        </fields>
    </domain-object-type>

    <domain-object-type name="country_city">
        <fields>
            <reference name="country" type="country"/>
            <reference name="city" type="city"/>
        </fields>
    </domain-object-type>
    <domain-object-type name="country_most_famous_city">
        <fields>
            <reference name="country" type="country"/>
            <reference name="city" type="city"/>
        </fields>
    </domain-object-type>

    <domain-object-type name="confirm_country" initial-status="Active">
        <fields>
            <reference name="country" type="country" not-null="true"/>
            <string name="description" length="100" not-null="true">
                <constraints>
                    <simple-constraint value="not-empty"/>
                </constraints>
            </string>
        </fields>
    </domain-object-type>

    <domain-object-type name="city" initial-status="Active">
        <fields>
            <reference name="country" type="country"/>
            <string name="name" length="128"/>
            <long name="population" not-null="true"/>
            <long name="year_of_foundation"/>
            <decimal name="latitude" precision="9" scale="2"/>
            <decimal name="longitude" precision="9" scale="2"/>
            <decimal name="square" precision="9" scale="2"/>
        </fields>
    </domain-object-type>

    <domain-object-type name="federal_unit">
        <fields>
            <reference name="country" type="country"/>
            <string name="name" length="128"/>
            <decimal name="square" precision="9" scale="2"/>
            <reference name="capital" type="city"/>
        </fields>
    </domain-object-type>

    <domain-object-type name="federal_unit_city">
        <fields>
            <reference name="federal_unit" type="federal_unit"/>
            <reference name="city" type="city"/>
        </fields>
    </domain-object-type>

    <form name="country_form" domain-object-type="country" is-default="true" debug="false" min-width="900px">
        <act:tool-bar useDefault="true">
            <act:simple-action componentName="simple.action" action-handler="simple.action" text="Simple action"
                               permissions="Delete,Write,Create">
                <act:action-params>
                    <act:action-param name="param1" value="value1" />
                    <act:action-param name="param2" value="value2" />
                    <act:action-param name="param3" value="value3" />
                    <act:action-param name="param4" value="value4" />
                </act:action-params>
                <act:before-execution>
                    <act:confirmation-message text="Are you sure?"/>
                    <act:linked-domain-object title="Заголовок доп. формы">
                        <act:reference field-path="description_form|country" />
                        <act:perform-validation value="true"/>
                        <act:form-mapping form="confirm_country">
                            <act:users>
                                <act:user uid="admin"/>
                            </act:users>
                            <act:groups>
                                <act:group name="Administrators" priority="1"/>
                            </act:groups>
                        </act:form-mapping>
                    </act:linked-domain-object>
                    <act:save-context value="true"/>
                </act:before-execution>
                <act:after-execution>
                    <act:on-success-message text="Country '{name}' saved"/>
                </act:after-execution>
            </act:simple-action>
        </act:tool-bar>
        <markup>
            <header>
                <!--width="800px" height="200px"-->
                <table>
                    <tr>
                        <td h-align="right">
                            <widget id="1"/>
                        </td>
                        <!-- label (Название) -->
                        <td width="100%" h-align="left">
                            <widget id="2"/>
                        </td>
                    </tr>
                    <tr>
                        <td width="100%" colspan="2">
                            <widget id="actionExecutorId"/>
                        </td>
                    </tr>
                </table>
            </header>
            <body display-single-tab="false"> <!-- в теле - только закладки -->
                <tab name="Закладки">
                    <bookmarks> <!-- наследник от TabGroupsConfig -->
                        <tab-group name="Главная"> <!-- либо таб, либо разметка, вместе - нельзя -->
                            <table>
                                <tr>
                                    <td h-align="center" v-align="center">
                                        <widget id="3"/>
                                    </td>
                                    <!-- label (Население) -->
                                    <td h-align="left" width="50%">
                                        <widget id="4" width="100%"/>
                                    </td>
                                    <!-- integer-box (Население) -->
                                    <td>
                                        <widget id="5"/>
                                    </td>
                                    <!-- label (Площадь) -->
                                    <td h-align="left" width="50%">
                                        <widget id="6"/>
                                    </td>
                                    <!-- integer-box (Площадь) -->
                                </tr>
                                <tr>
                                    <td h-align="right">
                                        <widget id="100"/>
                                    </td>
                                    <td h-align="left">
                                        <widget id="101"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td h-align="right">
                                        <widget id="7"/>
                                    </td>
                                    <!-- label (Столица) -->
                                    <td colspan="3" h-align="left">
                                        <widget id="8a"/>
                                        <!--widget id="test"/-->
                                    </td>
                                </tr>
                                <tr>
                                    <!-- suggest-box (Столица) -->
                                    <td h-align="left">
                                        <widget id="cities_label"/>
                                    </td>
                                    <!-- suggest-box (Столица) -->
                                    <td h-align="left">
                                        <widget id="cities" />
                                    </td>
                                </tr>
                                <tr>
                                    <td h-align="right">
                                        <widget id="7a"/>
                                    </td>
                                    <!-- label (Известный город) -->
                                    <td colspan="3" h-align="left">
                                        <widget id="city_table"/>
                                    </td>
                                    <!-- suggest-box (Известный город) -->
                                </tr>
                                <tr>
                                    <td h-align="right">
                                        <widget id="9"/>
                                    </td>
                                    <!-- label (День независимости) -->
                                    <td colspan="3" h-align="left">
                                        <widget id="10"/>
                                    </td>
                                    <!-- date-box (День независимости) -->
                                </tr>
                                <tr>
                                    <!-- label (Информация) -->
                                    <td h-align="right">
                                        <widget id="summary_label"/>
                                    </td>
                                    <!-- label (Сама информация) -->
                                    <td colspan="3" h-align="left">
                                        <widget id="summary"/>
                                    </td>
                                </tr>
                            </table>
                        </tab-group>
                        <tab-group name="Описание"> <!-- либо таб, либо разметка, вместе - нельзя -->
                            <table>
                                <tr>
                                    <td h-align="right">
                                        <widget id="11"/>
                                    </td>
                                    <!-- label (Описание) -->
                                    <td h-align="left">
                                        <widget id="12"/>
                                    </td>
                                    <!-- text-area (Описание) -->
                                </tr>
                            </table>
                        </tab-group>
                    </bookmarks>
                </tab>
                <tab name="Города и Друзья">
                    <hiding-groups>
                        <tab-group name="Друзья" initial-state="closed">
                            <table>
                                <tr>
                                    <td>
                                        <widget id="best_friend_label"/>
                                    </td>
                                    <!-- label (Лучший друг) -->
                                    <td h-align="left">
                                        <widget id="best_friend"/>
                                    </td>
                                    <!-- text-box (Лучший друг (название)) -->
                                </tr>
                                <tr>
                                    <td>
                                        <widget id="best_desc_label"/>
                                    </td>
                                    <td h-align="left">
                                        <!--<widget id="best_friend_desc"/>-->
                                        <widget id="test"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <!--<widget id="best_desc_back_label"/>-->
                                        <widget id="test"/>
                                    </td>
                                    <td h-align="left">
                                        <!--<widget id="best_friend_desc_back"/>-->
                                        <widget id="test"/>
                                    </td>
                                    <td h-align="left">
                                        <!--<widget id="16"/>-->
                                        <widget id="test"/>
                                    </td>
                                </tr>
                            </table>
                        </tab-group>
                        <tab-group name="Города" initial-state="expanded">
                            <table>
                                <tr>
                                    <td h-align="right">
                                        <widget id="12"/>
                                    </td>
                                    <td h-align="left">
                                        <!--<widget id="14"/>-->
                                        <widget id="test"/>
                                    </td>
                                </tr>
                            </table>
                        </tab-group>
                    </hiding-groups>
                </tab>
                <tab name="Attachments">
                    <single-entry-group>
                        <tab-group>
                            <table>
                                <tr>
                                    <td>
                                        <widget id="15" width="600px"/>
                                    </td>
                                </tr>
                            </table>
                        </tab-group>
                    </single-entry-group>
                </tab>
                <tab name="Table Browser">
                    <single-entry-group>
                        <tab-group>
                            <table>
                                <tr>
                                    <td>
                                        <widget id="17a" width="600px"/>
                                    </td>
                                    <td>
                                        <widget id="bad_label" width="600px"/>
                                    </td>
                                </tr>
                            </table>
                        </tab-group>
                    </single-entry-group>
                </tab>
            </body>
        </markup>
        <widget-config>
            <label id="1">
                <field-path value="id"/>
                <pattern value="{id}, {created_date}"/>
                <all-values-empty-message value="empty"/>
                <formatting>

                    <date-format pattern="dd-mm-yyyy HH:mm:ss" style="short">
                        <time-zone id="Europe/Kiev"/>
                        <field-paths>
                            <field-path value="created_date"/>
                        </field-paths>
                    </date-format>
                </formatting>
            </label>
            <text-box id="2">
                <field-path value="name"/>
            </text-box>

            <action-executor id="actionExecutorId">
                <font-size value="10px"/>
                <font-weight value="bold"/>
                <field-path value="id"/>
                <pattern value="pattern: {created_date} id={id} "/>
                <all-values-empty-message value="empty"/>
                <formatting>
                    <date-format pattern="dd-mm-yyyy HH:mm:ss" style="short">
                        <time-zone id="Europe/Kiev"/>
                        <field-paths>
                            <field-path value="created_date"/>
                        </field-paths>
                    </date-format>
                </formatting>
                <act:action-ref actionId="aOpenLink" rendered="not toggle-edit or (toggle-edit and preview)">
                    <act:action-params>
                        <act:action-param name="base-url" value="https://www.google.com.ua" />
                        <act:action-param name="domain-object-fields" value="id,created_date"/>
                        <act:action-param name="date-time-format" value="yyyy-MM-dd hh:mm:ss"/>
                        <act:action-param name="date-time-format-time-zone" value="Europe/Moscow"/>
                        <act:action-param name="date-format" value="yyyy-MM-dd"/>
                        <act:action-param name="id" value="ID"/>
                        <act:action-param name="created_date" value="DATE_IN_URL"/>
                    </act:action-params>
                </act:action-ref>
            </action-executor>

            <label id="3">
                <text>Население:</text>
            </label>
            <integer-box id="4">
                <field-path value="population"/>
            </integer-box>

            <label id="5">
                <field-path/>
                <text>Площадь:</text>
            </label>
            <decimal-box id="6">
                <field-path value="square"/>
            </decimal-box>

            <label id="100">
                <field-path/>
                <text>Состоит:</text>
            </label>
            <radio-button id="101">
                <field-path value="country_union"/>
                <pattern value="{name}"/>
                <layout name="horizontal"/>
            </radio-button>

            <label id="7">
                <text>Столица:</text>
                <force-required-asterisk value="true"/>
            </label>
            <list-box id="8a">
                   <field-path value="capital"/>
                   <!--а для области столицы: capital . federal_unit_city^city . federal_unit . name -->
                   <pattern value="{name} ({population} чел.)"/>
               </list-box>

            <label id="7a">
                <text>Известный город:</text>
            </label>
            <!-- <suggest-box id="8a">
                 <field-path value="country_most_famous_city^country.city"/>
                &lt;!&ndash; <field-path value="most_famous_city"/>&ndash;&gt;
                 &lt;!&ndash; а для области столицы: capital . federal_unit_city^city . federal_unit . name &ndash;&gt;
                 <collection-ref name="Cities"/>

                 &lt;!&ndash; паттерн отображения значений выпадающего списка &ndash;&gt;
                 <drop-down-pattern value="{name} {population}"/>

                 &lt;!&ndash; паттерн отображения уже выбранных значений &ndash;&gt;
                 <selection-pattern value="{name} {population} {year_of_foundation}"/>

                 &lt;!&ndash; название фильтра по тексту, введённому пользователем &ndash;&gt;
                 <input-text-filter name="byText"/>

                 &lt;!&ndash; количество элементов, показываемых на одной странице выпадающего списка &ndash;&gt;
                 <page-size>30</page-size>

                 &lt;!&ndash;name может принимать 2 значения inline (стиль Студии Лебедева) и table (текущая реализация).
                     Если тэг отсутствует, то используется "inline"-вариант. &ndash;&gt;
                 <selection-style name="inline"/>
                 <clear-all-button  text="Очистить"/>
                 <display-values-as-links value="true"/>
             </suggest-box>-->
            <label id="cities_label">
                <text>Города:</text>
            </label>
            <suggest-box id="cities">
                <field-path value="city^country"/>

                <collection-ref name="Cities"/>
                <selection-filters row-limit="1"></selection-filters>
                <!-- паттерн отображения значений выпадающего списка -->
                <drop-down-pattern value="{name} {population}"/>

                <!-- паттерн отображения уже выбранных значений -->
                <selection-pattern value="{name} {population} {created_date}"/>

                <!-- название фильтра по тексту, введённому пользователем -->
                <input-text-filter name="byText"/>

                <!-- количество элементов, показываемых на одной странице выпадающего списка -->
                <page-size>30</page-size>
                   <display-values-as-links value="true"/>
                <!--name может принимать 2 значения inline (стиль Студии Лебедева) и table (текущая реализация).
                    Если тэг отсутствует, то используется "inline"-вариант. -->
                <selection-style name="inline"/>
                <single-choice value="false"/>
                <clear-all-button text="Очистить"/>
                <default-sort-criteria column-field="name" order="asc"/>
                <selection-sort-criteria>
                    <sort-criterion field="name" order="asc"/>
                </selection-sort-criteria>
                <linked-form name="city_form">
              <title>
                  <existing-object>
                      <pattern value="{id}, {created_date}"/>
                      <formatting>
                          <date-format pattern="dd-mm-yyyy HH-mm-ss" style="short">
                              <time-zone id="Europe/Kiev"/>
                              <field-paths>
                                  <field-path value="created_date"/>
                              </field-paths>
                          </date-format>
                      </formatting>
                  </existing-object>
                  <new-object>
                      <pattern value="new form "/>

                  </new-object>
              </title>

                </linked-form>
            </suggest-box>

            <!--<label id="best_friend_label">
                <text>Лучший друг (назв. страны):</text>
            </label>
            <text-box id="best_friend">
                <field-path value="country_best_friend^country.best_friend.name"/>
            </text-box>

            <label id="best_desc_label">
                <text>Description:</text>
            </label>
            <text-box id="best_friend_desc">
                <field-path value="country_best_friend^country.description.text"/>
            </text-box>

            <label id="best_desc_back_label">
                <text>Description (Back):</text>
            </label>
            <text-box id="best_friend_desc_back">
                <field-path value="country_best_friend^country.c_best_friend_desc_back^country_best_friend.text"/>
            </text-box>-->

            <label id="best_friend_label">
                <text>Краткое название:</text>
            </label>
            <text-box id="best_friend">
                <field-path value="short_name"/>
            </text-box>

            <label id="best_desc_label">
                <text>Города (N:M)</text>
            </label>
            <!-- <list-box id="best_friend_desc">
                 <field-path value="country_city^country.city"/>
                 <pattern value="{name} ({population} чел.)"/>
             </list-box>-->

            <label id="9">
                <text>День независимости:</text>
            </label>
            <label id="test">
                <text>TEST</text>
            </label>
            <date-box id="10">
                <field-path value="independence_day"/>
                <time-zone-id>GMT-4</time-zone-id>
                <pattern>dd.MM.yyyy HH:mm:ss</pattern>
                <display-time-zone-choice>true</display-time-zone-choice>
                <display-time-box>true</display-time-box>
            </date-box>

            <label id="summary_label">
                <text>Информация:</text>
            </label>
            <!--
            font-size: 15em
            font-style: normal | italic | oblique
            font-weight: bold | bolder | lighter | normal
            -->
            <label id="summary">
                <field-path value="name, population, independence_day, capital.name"/>
                <font-weight value="bolder"/>
                <font-style value="italic"/>
                <font-size value="8px"/>
                <pattern value="{name}, {population}. День независимости: {independence_day}, столица: {capital.name}"/>
                <all-values-empty-message value="День независимости: столица:"/>
            </label>

            <label id="11">
                <field-path value="name, population, independence_day, capital.name"/>
                <renderer component-name="custom.renderer"/>
            </label>
            <text-area id="12">
                <field-path value="description"/>
            </text-area>

            <label id="13">
                <text>Города:</text>
            </label>

            <!-- <list-box id="14"> &lt;!&ndash; в поле City.country надо сохранить Id текущей страны??? &ndash;&gt;
                 <field-path value="city^country"/>
                 &lt;!&ndash; редактирует названи&ndash;&gt;
                 <pattern value="{name} ({population} чел.)"/>
                <single-choice value="true"/>
             </list-box>-->
            <attachment-box id="15">
                <field-path value="country_attachment^country"/>
                <!-- Впоследствии будет добавлена поддержка, тогда не обязателен станет field-path. Сейчас добавлять не надо. -->
                <attachment-type-ref name="country_attachment"/>
                <scanner enabled="true"/>
                <selection-style name="inline"/>
                <single-choice value="false"/>
                <!--<action-link text="Открыть плагин" action-name="test.action"/>-->
            </attachment-box>

            <table-browser id="17a" read-only="false">
                <field-path value="city^country"/>
                <collection-ref name="Cities"/>

                <collection-view-ref name="cities_default_view"/>
                <selection-filters row-limit="2">

                </selection-filters>
                <!-- паттерн отображения уже выбранных значений -->
                <selection-pattern value="{name} {population} {year_of_foundation}"/>

                <!-- название фильтра по тексту, введённому пользователем -->
                <input-text-filter name="byNameforTableBrowser"/>

                <!-- количество элементов, показываемых на одной странице выпадающего списка. в правом нижнем углу
                под таблицей указатель страниц (за пример нужно взять страницы поиска в Яндексе) -->
                <page-size>30</page-size>
                <display-chosen-values value="false"/>
                <selection-style name="inline"/>
                <single-choice value="false"/>
                <clear-all-button text="Очистить"/>
             <!--   <add-button image="..." text="Добавить"/>-->
                <selection-sort-criteria>
                    <sort-criterion field="name" order="asc"/>
                </selection-sort-criteria>
                <display-values-as-links value="true"/>
                <linked-form name="city_form">
                    <title>
                        <existing-object>
                            <pattern value="{id}, {created_date}"/>
                            <formatting>
                                <date-format pattern="dd-mm-yyyy HH-mm-ss" style="short">
                                    <time-zone id="Europe/Kiev"/>
                                    <field-paths>
                                        <field-path value="created_date"/>
                                    </field-paths>
                                </date-format>
                            </formatting>
                        </existing-object>
                        <new-object>
                            <pattern value="new form "/>

                        </new-object>
                    </title>

                </linked-form>
            </table-browser>
            <!--<linked-domain-objects-table id="city_table" modal-width="1200px" modal-height="305px">-->
            <linked-domain-objects-table id="city_table" modal-width="500px" modal-height="300px"
                                         max-tooltip-width="300px">
                <field-path value="country_most_famous_city^country.city"/>
                <linked-form name="city_form" inline="true">
                        <title>
                            <existing-object>
                                <pattern value="{id}, {created_date}"/>
                                <formatting>
                                    <date-format pattern="dd-mm-yyyy HH-mm-ss" style="short">
                                        <time-zone id="Europe/Kiev"/>
                                        <field-paths>
                                            <field-path value="created_date"/>
                                        </field-paths>
                                    </date-format>
                                </formatting>
                            </existing-object>
                            <new-object>
                                <pattern value="new form "/>

                            </new-object>
                        </title>
                </linked-form>
                <collection-ref name="Cities"/>
                <selection-filters row-limit="1">

                </selection-filters>
                <summary-table>
                    <summary-table-column header="Название" widget-id="2">
                        <pattern value="{name}"/>
                        <!-- пути задаются относительно базового field-path (correspondent) -->
                        <formatting>
                            <number-format pattern="###.####">
                                <field-paths> <!-- описание путей к полям, к которым применяется форматирование -->
                                    <field-path value="age"/>
                                </field-paths>
                            </number-format>
                            <date-format pattern="dd-mm-yyyy" style="short">
                                <field-paths>
                                    <field-path value="date_of_birth"/>
                                </field-paths>
                            </date-format>
                        </formatting>
                    </summary-table-column>
                    <summary-table-column header="Население" widget-id="4">
                        <pattern value="{population}"/>
                    </summary-table-column>
                </summary-table>
                <selection-sort-criteria>
                    <sort-criterion field="name" order="asc"/>
                </selection-sort-criteria>
                <single-choice value="false"/>

            </linked-domain-objects-table>
            <label id="bad_label">
                <pattern value="date {created_date}"/>
                <field-path value="created_date"/>
            <formatting>

                <date-format pattern="dd.MM.yyyy HH:mm" style="short">
                <time-zone id="Etc/GMT+1"/>
                    <field-paths>
                        <field-path value="created_date"/>
                    </field-paths>
                </date-format>
            </formatting>
            </label>
        </widget-config>
        <widget-groups>
            <widget-group name="country-union-group">
                <widget-ref id="100"/>
                <widget-ref id="101"/>
            </widget-group>
        </widget-groups>
    </form>

    <form name="confirm_country" domain-object-type="confirm_country" is-default="true">
        <markup>
            <header>
                <table>
                    <tr>
                        <td h-align="right">
                            <widget id="confirm_label"/>
                        </td>
                        <td>
                            <widget id="confirm_description"/>
                        </td>
                    </tr>
                </table>
            </header>
            <body display-single-tab=""></body>
        </markup>
        <widget-config>
            <label id="confirm_label">
                <force-required-asterisk value="true"/>
                <text>Добавить комментарий:</text>
            </label>
            <text-box id="confirm_description">
                <field-path value="description"/>
            </text-box>
        </widget-config>
    </form>

    <form name="city_form" domain-object-type="city" is-default="true">
        <markup>
            <title>
                <new-object label-widget-id="titleNew"/>
                <existing-object label-widget-id="titleExisting"/>
            </title>
            <header>
                <table>
                    <tr>
                        <td width="100px" h-align="right">
                            <widget id="1"/>
                        </td>
                        <!-- label (Название) -->
                        <td width="100%" h-align="left">
                            <widget id="2"/>
                        </td>
                        <td width="100%" h-align="left">
                            <widget id="date"/>
                        </td>
                        <!-- text-box (Название) -->
                    </tr>
                </table>
            </header>
            <body display-single-tab="false"> <!-- в теле - только закладки -->
                <tab name="Главная"> <!-- закладка состоит из групп с разметкой -->
                    <single-entry-group> <!-- наследник от TabGroupsConfig -->
                        <tab-group> <!-- вхождение в группу уже может содержать разметку -->
                            <table>
                                <tr>
                                    <td h-align="right">
                                        <widget id="3"/>
                                    </td>
                                    <!-- label (Население) -->
                                    <td h-align="left">
                                        <widget id="4"/>
                                    </td>
                                    <!-- integer-box (Население) -->

                                </tr>
                                <tr>
                                    <td h-align="right">
                                        <widget id="5"/>
                                    </td>
                                    <!-- label (Год основания) -->
                                    <td colspan="3" h-align="left">
                                        <widget id="6"/>
                                    </td>
                                    <!-- date-box (Год основания) -->
                                </tr>
                            </table>
                        </tab-group>
                    </single-entry-group>
                </tab>
                <tab name="Дополнительно">
                    <single-entry-group>
                        <tab-group>
                            <table>
                                <tr>
                                    <td h-align="right">
                                        <widget id="7"/>
                                    </td>
                                    <!-- label (Площадь) -->
                                    <td colspan="3" h-align="left">
                                        <widget id="8"/>
                                    </td>
                                    <!-- decimal-box (Площадь) -->
                                </tr>
                                <tr>
                                    <td h-align="right">
                                        <widget id="9"/>
                                    </td>
                                    <!-- label (Широта) -->
                                    <td h-align="left">
                                        <widget id="10"/>
                                    </td>
                                    <!-- decimal-box  (Широта) -->

                                </tr>
                                <tr>
                                    <td h-align="right">
                                        <widget id="11"/>
                                    </td>
                                    <!-- label (Долгота) -->
                                    <td colspan="3" h-align="left">
                                        <widget id="12"/>
                                    </td>
                                    <!-- label (Долгота) -->
                                    <td colspan="3" h-align="left">
                                        <widget id="countries"/>
                                    </td>
                                    <!-- decimal-box  (Долгота) -->
                                </tr>
                            </table>
                        </tab-group>
                    </single-entry-group>
                </tab>

            </body>
        </markup>
        <widget-config>
            <date-box id="date">
                <field-path value="created_date"/>

            </date-box>
            <label id="1">
                <field-path/>
                <text>Название:</text>
            </label>
            <text-box id="2">
                <field-path value="name"/>
            </text-box>

            <label id="3">
                <text>Население:</text>
                <relates-to widget-id="4"/>
                <force-required-asterisk value="true"/>
            </label>
            <integer-box id="4">
                <field-path value="population"/>
            </integer-box>

            <label id="5">
                <text>Год основания:</text>
            </label>
            <integer-box id="6" read-only="true">
                <field-path value="year_of_foundation"/>
            </integer-box>

            <label id="7">
                <text>Площадь:</text>
            </label>
            <decimal-box id="8">
                <field-path value="square"/>
            </decimal-box>

            <label id="9">
                <text>Широта:</text>
            </label>
            <decimal-box id="10">
                <field-path value="latitude"/>
            </decimal-box>

            <label id="11">
                <text>Долгота:</text>
            </label>
            <decimal-box id="12">
                <field-path value="longitude"/>
            </decimal-box>
            <suggest-box id="countries">
                <field-path value="country"/>

                <collection-ref name="Countries"/>

                <!-- паттерн отображения значений выпадающего списка -->
                <drop-down-pattern value="{name} {population}"/>

                <!-- паттерн отображения уже выбранных значений -->
                <selection-pattern value="{name} {population} "/>

                <!-- название фильтра по тексту, введённому пользователем -->
                <input-text-filter name="byName"/>

                <!-- количество элементов, показываемых на одной странице выпадающего списка -->
                <page-size>30</page-size>

                <!--name может принимать 2 значения inline (стиль Студии Лебедева) и table (текущая реализация).
                    Если тэг отсутствует, то используется "inline"-вариант. -->
                <selection-style name="inline"/>
                <single-choice value="false"/>
               <selection-sort-criteria>
                   <sort-criterion field="name" order="asc"/>
               </selection-sort-criteria>
            </suggest-box>
            <label id="titleExisting">
                <pattern value="date: {created_date}"/>
                <field-path value="created_date"/>
                <formatting>

                    <date-format pattern="dd.MM.yyyy HH:mm" style="short">

                        <field-paths>
                            <field-path value="created_date"/>
                        </field-paths>
                    </date-format>
                </formatting>
            </label>
            <label id="titleNew">
                <text>Coздание города</text>
            </label>
        </widget-config>
    </form>

    <form name="my-custom-form" domain-object-type="country" debug="false" min-width="900px">
        <act:tool-bar useDefault="true"/>
        <markup>
            <header>
                <table>
                    <tr>
                        <td h-align="right">
                            <widget id="title_label"/>
                        </td>
                    </tr>
                </table>
            </header>
            <body display-single-tab="false">
                <tab name="Закладки">
                    <single-entry-group>
                        <tab-group>
                            <table>
                                <tr>
                                    <td h-align="center" v-align="center">
                                        <widget id="description_label"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td h-align="center" v-align="center">
                                        <widget id="name_label"/>
                                    </td>
                                    <td h-align="center" v-align="center">
                                        <widget id="name_text-box"/>
                                    </td>
                                </tr>
                            </table>
                        </tab-group>
                    </single-entry-group>
                </tab>
            </body>
        </markup>
        <widget-config>
            <label id="title_label">
                <text>Custom form</text>
            </label>
            <label id="description_label">
                <text>Custom form provided by custom mapping component</text>
            </label>
            <label id="name_label">
                <text>Название:</text>
            </label>
            <text-box id="name_text-box">
                <field-path value="name"/>
            </text-box>
        </widget-config>
    </form>

    <collection name="Countries" idField="id">
        <!--todo поддержка конвертации значений, например, в картинки -->
        <prototype>
            <![CDATA[
                select
                    co.id, co.name, co.independence_day, co.population, co.description, co.capital, co.square,
                    cou.name as country_union_name
                from country co
                left join country_union cou on cou.id=co.country_union

                where
                    1=1 ::where-clause
            ]]>
        </prototype>
        <!-- если запрос-счётчик отсутствует, то в select подставляется count(*) вместо названий колонок -->
        <counting-prototype>
            select count(*) from country co ::from-clause WHERE 1=1 ::where-clause
        </counting-prototype>

        <filter name="byName">
            <criteria placeholder="where-clause">
                <![CDATA[
                    co.name like {0}
                ]]>
            </criteria>
        </filter>

        <filter name="byIndependenceDay">
            <criteria placeholder="where-clause">
                <![CDATA[
                   co.independence_day between {0} and {1}
                ]]>
            </criteria>
        </filter>

        <filter name="byPopulation">
            <criteria placeholder="where-clause">
                <![CDATA[
                   co.population = {0}
                ]]>
            </criteria>
        </filter>

        <filter name="byDescription">
            <criteria placeholder="where-clause">
                <![CDATA[
                    co.description like {0}
                ]]>
            </criteria>
        </filter>

        <filter name="bySquare">
            <criteria placeholder="where-clause">
                <![CDATA[
                    co.square  = {0}
                ]]>
            </criteria>
        </filter>
    </collection>
    <collection-view name="countries_default_view" collection="Countries" is-default="true">
        <display>
            <column field="id" name="id" type="integer" sortable="false" max-width="250px" text-break-style="cut"/>
            <column field="name" name="Название" editable="false" type="string" sortable="true" search-filter="byName"
                    min-width="300px" text-break-style="cut"/>
            <column field="independence_day" name="День Независимости" type="datetime" editable="false" resizable="true"
                    min-width="270px"
                    sortable="true" search-filter="byIndependenceDay" date-pattern="dd.MM.yyyy"
                    date-range="true"/>
            <column field="population" name="Популяция" type="long" editable="false" sortable="true"
                    search-filter="byPopulation">
                <renderer component-name="default.image.renderer"/>
                <image-mappings imageWidth="30px" imageHeight="30px">
                    <mapping value="" image="cancel.png"/>
                    <mapping value="0" image="addButton.png"/>
                    <mapping value="45469800" image="addButton.png"/>
                    <mapping value="143548980" image="CMJSpinner.gif"/>
                </image-mappings>
            </column>
            <column field="country_union_name" name="Состоит" type="string" editable="false" sortable="false"/>
            <column field="description" name="Описание" type="string" editable="false" sortable="true"
                    search-filter="byDescription"/>
            <column field="square" name="Площадь" type="string" editable="false" sortable="true"
                    search-filter="bySquare"/>
        </display>
    </collection-view>

    <collection-view name="cities_default_view" collection="Cities" is-default="true">
        <display>
            <column field="id" name="id" type="integer" sortable="false"/>
            <column field="name" name="Название" editable="false" type="string" sortable="true" search-filter="byText"/>
            <column field="population" name="Популяция" type="string" editable="false" sortable="true">
                <asc-sort-criteria>
                    <sort-criterion field="population" order="asc"/>
                    <sort-criterion field="name" order="desc"/>
                </asc-sort-criteria>
                <desc-sort-criteria>
                    <sort-criterion field="population" order="desc"/>
                    <sort-criterion field="name" order="asc"/>
                </desc-sort-criteria>
            </column>
            <column field="year_of_foundation" name="Год основания " type="integer" editable="false" sortable="true"/>
            <column field="latitude" name="Широта" type="string" editable="false" sortable="true"/>
            <column field="longitude" name="Долгота" type="string" editable="false" sortable="true"/>
            <column field="square" name="Площадь" type="string" editable="false" sortable="true"/>
        </display>
    </collection-view>

    <form-mappings name="country_mappings">
        <form-mapping domain-object-type="country" form="country_form">
            <users>
                <user uid="admin"/>
            </users>
            <groups>
                <group name="Administrators"/>
            </groups>
        </form-mapping>

        <form-mapping domain-object-type="confirm_country" form="confirm_country">
            <users>
                <user uid="admin"/>
            </users>
            <groups>
                <group name="Administrators"/>
            </groups>
        </form-mapping>

        <form-mapping domain-object-type="country" form="country_form">
            <users>
                <user uid="person1"/>
            </users>
            <groups>
                <group name="test-group-1" priority="1"/>
            </groups>
        </form-mapping>

        <form-widget-access form="country_form">
            <hide-widget widget-id="1"> <!--created_date-->
                <users>
                    <user uid="person4"/>
                </users>
                <groups>
                    <group name="EmployeeBosses"/> <!-- person1, person2 -->
                </groups>
            </hide-widget>
            <hide-widget widget-group-id="country-union-group">
                <users>
                    <user uid="person1"/>
                    <user uid="person5"/>
                </users>
            </hide-widget>
        </form-widget-access>
    </form-mappings>

    <form-mappings name="country_mappings_2">
        <form-mapping domain-object-type="country" form="my-custom-form">
            <users>
                <user uid="person2"/>
                <user uid="person7"/>
            </users>
            <groups>
                <group name="EmployeeBosses"/>
                <group name="test-group-2" priority="2"/>
            </groups>
        </form-mapping>
    </form-mappings>

    <form-mappings name="city_mappings">
        <form-mapping domain-object-type="city" form="city_form">
            <users>
                <user uid="admin"/>
            </users>
            <groups>
                <group name="Minister" priority="2"/>
            </groups>
        </form-mapping>
    </form-mappings>

</configuration>
