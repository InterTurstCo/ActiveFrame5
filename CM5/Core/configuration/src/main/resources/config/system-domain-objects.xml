<?xml version="1.1" encoding="UTF-8" standalone="yes"?>
<configuration xmlns="https://cm5.intertrust.ru/config">

    <domain-object-type name="Attachment" template="true">
        <fields>
            <string name="Name" length="128"/>
            <string name="Path" length="128"/>
            <string name="MimeType" length="128"/>
            <string name="Description" length="128"/>
            <long name="ContentLength"/>
        </fields>
    </domain-object-type>

    <domain-object-type name="Status" db-id="31">
        <fields>
            <string name="Name" length="128" not-null="true"/>
        </fields>
        <indices>
            <index>
                <field name="Name"/>
            </index>
        </indices>
    </domain-object-type>
    <domain-object-type name="bu_user_settings">
        <fields>
            <reference name="person" type="person"/>
            <string name="theme" length="128"/>
            <long name="splitter_orientation"/>
            <long name="splitter_position"/>
        </fields>
    </domain-object-type>
    <domain-object-type name="bu_nav_link_collection">
        <fields>
            <reference name="person" type="person"/>
            <string name="link" length="128"/>
            <string name="collection_view_name" length="128"/>
            <text name="collection_view"/>
            <text name="collection_viewer"/>
            <long name="collection_count"/>
        </fields>
    </domain-object-type>
    <collection name="bu_user_settings_collection" idField="id">
        <prototype>
            <![CDATA[
                    select bus.id, bus.theme, bus.splitter_orientation, bus.splitter_position
                    from bu_user_settings bus
                    inner join Person p on (p.id = bus.person)
                    ::from-clause
                    where 1=1 ::where-clause
            ]]>
        </prototype>
        <counting-prototype>
            select count(*) from bu_user_settings bus bus ::from-clause WHERE 1=1 ::where-clause
        </counting-prototype>
        <filter name="byPerson">
            <criteria placeholder="where-clause">
                <![CDATA[
                    p.login = {0}
                ]]>
            </criteria>
        </filter>
    </collection>

    <collection name="bu_nav_link_collections" idField="id">
        <prototype>
            <![CDATA[
                select
                    blc.id, blc.collection_view, blc.collection_viewer
                from
                    bu_nav_link_collection blc
                    inner join Person p on (blc.person = p.id)
                     ::from-clause
                where
                    1=1 ::where-clause
            ]]>
        </prototype>
        <!-- если запрос-счётчик отсутствует, то в select подставляется count(*) вместо названий колонок -->
        <counting-prototype>
            select count(*) from bu_nav_link_collection blc ::from-clause WHERE 1=1 ::where-clause
        </counting-prototype>

        <filter name="byLink">
            <criteria placeholder="where-clause">
                <![CDATA[
                    blc.link = {0}
                ]]>
            </criteria>
        </filter>
        <filter name="byCollectionViewName">
            <criteria placeholder="where-clause">
                <![CDATA[
                    blc.collection_view_name = {0}
                ]]>
            </criteria>
        </filter>
        <filter name="byPerson">
            <criteria placeholder="where-clause">
                <![CDATA[
                    p.login = {0}
                ]]>
            </criteria>
        </filter>
    </collection>
</configuration>