<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<configuration xmlns="https://cm5.intertrust.ru/config">
    <collection name="Employees" idField="id"
        domain-object-type="Employee">
        <!--todo поддержка конвертации значений, например, в картинки -->
        <display>
            <column field="id" name="id" type="integer" hidden="true"
                sortable="false" />
            <column field="business_object_type" name="type"
                type="string" editable="false" hidden="true" sortable="false" /> <!--todo - rethink? -->
            <column field="name" name="Имя" editable="false"
                type="string" sortable="true" />
            <column field="position" name="Должность" type="string"
                editable="false" sortable="true" />
            <column field="created_date" name="Дата создания"
                type="datetime" editable="false" sortable="true" />
            <column field="updated_date" name="Дата модификации"
                type="datetime" editable="false" sortable="true" />
        </display>

        <prototype>
            <![CDATA[
                select
                    e.id, e.name, e.position
                from
                    Employee e
                     ::from-clause
                where
                    1=1 ::where-clause
            ]]>
        </prototype>

        <!-- если запрос-счётчик отсутствует, то в select подставляется count(*) 
            вместо названий колонок -->
        <counting-prototype>
            select count(*) from Employee e ::from-clause WHERE 1=1 ::where-clause
        </counting-prototype>

        <filter name="byDepartment">
            <reference placeholder="from-clause">
                 <![CDATA[
                    inner join department d on e.department = d.id
                ]]>
            </reference>

            <!-- по умолчанию and, если перед условием нет других (только 
                ключ. слово where), то условие опускаем -->
            <!-- {0} - это параметр фильтра, у одного фильтра может быть 
                несколько параметров -->
            <criteria placeholder="where-clause">
                <![CDATA[
                    d.name = {0}
                ]]>
            </criteria>
        </filter>

        <filter name="byName">
            <criteria placeholder="where-clause">
                <![CDATA[
                    e.name = {0}
                ]]>
            </criteria>
        </filter>
        <filter name="byFirstLetter">
            <criteria placeholder="where-clause">
                <![CDATA[
                    e.name like {0} || '%'
                ]]>
            </criteria>
        </filter>
    </collection>

    <collection name="Employees_2" idField="id"
        domain-object-type="Employee">
        <display>
            <column field="id" name="id" type="integer" hidden="true"
                sortable="false" />
            <column field="business_object_type" name="type"
                type="string" editable="false" hidden="true" sortable="false" /> <!--todo - rethink? -->
            <column field="name" name="Имя" type="string"
                editable="false" sortable="true" />
            <column field="position" name="Должность" type="string"
                editable="false" sortable="true" />
            <column field="created_date" name="Дата создания"
                type="string" editable="false" sortable="true" />
            <column field="updated_date" name="Дата модификации"
                type="string" editable="false" sortable="true" />
        </display>
        <renderer
            className="ru.intertrust.cm.core.business.impl.EmployeesCollectionRenderer" />
        <filter name="byName" />
        <filter name="byDepartment" />
    </collection>

    <collection name="Outgoing_Document" idField="id"
        domain-object-type="Outgoing_Document">
        <!--todo поддержка конвертации значений, например, в картинки -->
        <display>
            <column field="id" name="id" type="integer" hidden="true"
                sortable="false" />
            <column field="business_object_type" name="type"
                type="string" editable="false" hidden="true" sortable="false" /> <!--todo - rethink? -->
            <column field="name" name="Имя" editable="false"
                type="string" sortable="true" />
            <column field="description" name="Описание" type="string"
                editable="false" sortable="true" />
            <column field="created_date" name="Дата создания"
                type="datetime" editable="false" sortable="true" />
            <column field="updated_date" name="Дата модификации"
                type="datetime" editable="false" sortable="true" />
            <column field="registration_date" name="Дата регистрации"
                type="datetime" editable="false" sortable="true" />
        </display>

        <prototype>
            <![CDATA[
                select
                    od.id, od.name, od.description, od.registration_date
                from
                    Outgoing_document od
                     ::from-clause
                where
                    1=1 ::where-clause
            ]]>
        </prototype>

        <!-- если запрос-счётчик отсутствует, то в select подставляется count(*) 
            вместо названий колонок -->
        <counting-prototype>
            select count(*) from Outgoing_document od ::from-clause WHERE 1=1 ::where-clause
        </counting-prototype>

    </collection>

    <collection name="Assignment" idField="id"
        domain-object-type="Assignment">
        <!--todo поддержка конвертации значений, например, в картинки -->
        <display>
            <column field="id" name="id" type="integer" hidden="true"
                sortable="false" />
            <column field="business_object_type" name="type"
                type="string" editable="false" hidden="true" sortable="false" /> <!--todo - rethink? -->
            <column field="name" name="Имя" editable="false"
                type="string" sortable="true" />
            <column field="description" name="Описание" type="string"
                editable="false" sortable="true" />
            <column field="created_date" name="Дата создания"
                type="datetime" editable="false" sortable="true" />
            <column field="updated_date" name="Дата модификации"
                type="datetime" editable="false" sortable="true" />
        </display>

        <prototype>
            <![CDATA[
                select
                    s.id, s.name, s.description,s.master
                from
                    Assignment s
                     ::from-clause
                where
                    1=1 ::where-clause
            ]]>
        </prototype>

        <!-- если запрос-счётчик отсутствует, то в select подставляется count(*) 
            вместо названий колонок -->
        <counting-prototype>
            select count(*) from Assignment s ::from-clause WHERE 1=1 ::where-clause
        </counting-prototype>
        <filter name="byDoc">
            <criteria placeholder="where-clause">
                <![CDATA[
                    s.master = {0}
                ]]>
            </criteria>
        </filter>
    </collection>

    <collection name="Outgoing_Document" idField="id"
        domain-object-type="Outgoing_Document">
        <!--todo поддержка конвертации значений, например, в картинки -->
        <display>
            <column field="id" name="id" type="integer" hidden="true"
                sortable="false" />
            <column field="business_object_type" name="type"
                type="string" editable="false" hidden="true" sortable="false" /> <!--todo - rethink? -->
            <column field="name" name="Имя" editable="false"
                type="string" sortable="true" />
            <column field="description" name="Описание" type="string"
                editable="false" sortable="true" />
            <column field="created_date" name="Дата создания"
                type="datetime" editable="false" sortable="true" />
            <column field="updated_date" name="Дата модификации"
                type="datetime" editable="false" sortable="true" />
            <column field="registration_date" name="Дата регистрации"
                type="datetime" editable="false" sortable="true" />
        </display>

        <prototype>
            <![CDATA[
                select
                    od.id, od.name, od.description, od.registration_date
                from
                    outgoing_document od
                     ::from-clause
                where
                    1=1 ::where-clause
            ]]>
        </prototype>

        <!-- если запрос-счётчик отсутствует, то в select подставляется count(*) 
            вместо названий колонок -->
        <counting-prototype>
            select count(*) from outgoing_document od ::from-clause WHERE 1=1
            ::where-clause
        </counting-prototype>

    </collection>

    <collection name="PersonByLogin" idField="id"
        domain-object-type="Person">
        <display>
            <column field="id" name="id" type="integer" hidden="true"
                sortable="false" />
            <column field="Login" name="Логин" type="string"
                editable="false" sortable="true" />
        </display>

        <prototype>
            <![CDATA[
                select
                    s.id, s.login
                from
                    person s
                     ::from-clause
                where
                    1=1 ::where-clause
            ]]>
        </prototype>

        <filter name="byLogin">
            <criteria placeholder="where-clause">
                <![CDATA[
                    s.login = {0}
                ]]>
            </criteria>
        </filter>
    </collection>

    <collection name="PersonInGroup" idField="id"
        domain-object-type="Person">
        <display>
            <column field="id" name="id" type="integer" hidden="true"
                sortable="false" />
        </display>

        <prototype>
            <![CDATA[
                select
                    g.person_id1
                from
                    group_member g 
                     ::from-clause
                where
                    1=1 ::where-clause
            ]]>
        </prototype>

        <filter name="byGroup">
            <criteria placeholder="where-clause">
                <![CDATA[
                    g.id = {0}
                ]]>
            </criteria>
        </filter>
    </collection>

    <collection name="AllPersonInGroup" idField="id"
        domain-object-type="Person">
        <display>
            <column field="id" name="id" type="integer" hidden="true"
                sortable="false" />
        </display>

        <prototype>
            <![CDATA[
                select
                    g.person_id1
                from
                    group_member g 
                     ::from-clause
                where
                    1=1 ::where-clause
            ]]>
        </prototype>

        <filter name="byGroup">
            <criteria placeholder="where-clause">
                <![CDATA[
                    g.id = {0}
                ]]>
            </criteria>
        </filter>
    </collection>

    <collection name="IsPersonInGroup" idField="id"
        domain-object-type="Person">
        <display>
            <column field="id" name="id" type="integer" hidden="true"
                sortable="false" />
        </display>

        <prototype>
            <![CDATA[
                select
                    g.person_id1
                from
                    group_member g 
                     ::from-clause
                where
                    1=1 ::where-clause
            ]]>
        </prototype>

        <filter name="byGroupAndPerson">
            <criteria placeholder="where-clause">
                <![CDATA[
                    g.id = {0} and g.person_id1  = {1}
                ]]>
            </criteria>
        </filter>
    </collection>

    <collection name="PersonGroups" idField="id"
        domain-object-type="User_Group">
        <display>
            <column field="id" name="id" type="integer" hidden="true"
                sortable="false" />
        </display>

        <prototype>
            <![CDATA[
                select
                    g.id
                from
                    group_member g 
                     ::from-clause
                where
                    1=1 ::where-clause
            ]]>
        </prototype>

        <filter name="byPerson">
            <criteria placeholder="where-clause">
                <![CDATA[
                    g.person_id1  = {0}
                ]]>
            </criteria>
        </filter>
    </collection>

    <collection name="PersonTask" idField="id"
        domain-object-type="Person_Task">
        <display>
            <column field="id" name="id" type="integer" hidden="true"
                sortable="false" />
        </display>

        <prototype>
            <![CDATA[
                select
                    t.id
                from
                    Person_Task t inner join assignee_person ap on (t.id = ap.persontask1) 
                     ::from-clause
                where
                    t.state in (1,2) ::where-clause
            ]]>
        </prototype>

        <filter name="byPerson">
            <criteria placeholder="where-clause">
                <![CDATA[
                    ap.person1  = {0}
                ]]>
            </criteria>
        </filter>
        <filter name="byAttachment">
            <criteria placeholder="where-clause">
                <![CDATA[
                    t.mainattachment  = {0}
                ]]>
            </criteria>
        </filter>
    </collection>

    <collection name="PersonGroupTask" idField="id"
        domain-object-type="Person_Task">
        <display>
            <column field="id" name="id" type="integer" hidden="true"
                sortable="false" />
        </display>

        <prototype>
            <![CDATA[
                select
                    t.id
                from
                    person_task t 
                    inner join assignee_group ag on (t.id = ag.persontask1)
                    inner join group_member gm on (ag.usergroup1 = gm.master)  
                     ::from-clause
                where
                     t.state in (1,2) ::where-clause
            ]]>
        </prototype>

        <filter name="byPerson">
            <criteria placeholder="where-clause">
                <![CDATA[
                    gm.person_id1  = {0}
                ]]>
            </criteria>
        </filter>
        <filter name="byAttachment">
            <criteria placeholder="where-clause">
                <![CDATA[
                    t.mainattachment  = {0}
                ]]>
            </criteria>
        </filter>
    </collection>

</configuration>
