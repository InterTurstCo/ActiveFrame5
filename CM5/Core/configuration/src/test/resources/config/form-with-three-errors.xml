<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<configuration xmlns="https://cm5.intertrust.ru/config">
    <!-- Для одного типа доменного объекта может существовать множество форм. Для входящего документа, у регистратора - своя форма,
    у министра - своя форма, содержащая, скорее всего, другие элементы.

    domain-object-type + role(s) + user(s) + "use default" => Form
    Такой мэппинг позволит одной роли увидеть 2 разные формы для одного типа ДО - одну "свою" и другую "для всех".
    Также, при необходимости, можно получить форму по имени: form_name => Form

    todo: впоследствии, вероятно, форму можно будет определить исходя из статуса доменного объекта

    is-default определяет факт того, что данная форма является таковой "по умолчанию", то есть используется для тех пользователей и ролей, для которых форма не переопределена -->
    <form name="incoming_document_base_form" domain-object-type="incoming_document" is-default="true">
        <markup>
            <header>
                <table width="500px" height="200px" row-height="50pxx" col-width="20%" h-align="left" v-align="top">
                    <tr height="100px" v-align="top">
                        <td width="50%"><widget id="1"/></td> <!-- label-list (Входящие, Акт) -->
                    </tr>
                    <tr>
                        <td colspan="5"><widget id="2"/></td> <!-- text-box -->
                    </tr>
                </table>
            </header>
            <body display-single-tab="false"> <!-- в теле - только закладки -->
                <tab name="Содержание"> <!-- закладка состоит из групп с разметкой -->
                    <single-entry-group> <!-- наследник от TabGroupsConfig -->
                        <tab-group> <!-- вхождение в группу уже может содержать разметку -->
                            <table>
                                <tr>
                                    <td><widget id="9"/></td>  <!-- label (Текст) -->
                                </tr>
                            </table>
                        </tab-group>
                    </single-entry-group>
                </tab>
                <tab name="Реквизиты"> <!-- закладка состоит из групп -->
                    <hiding-groups> <!-- наследник от TabGroupsConfig -->
                        <tab-group name="Основные">
                            <table>
                                <tr>
                                    <td><widget id="5"/></td>  <!-- label (Адресаты) -->
                                    <td><widget id="2"/></td>  <!-- suggest-box (Адресаты) -->
                                </tr>
                            </table>
                        </tab-group>
                        <tab-group name="Дополнительные">
                            <table>
                                <tr>
                                    <td v-align="middle"><widget id="1"/></td>  <!-- label (Место регистрации) -->
                                </tr>
                            </table>
                        </tab-group>
                    </hiding-groups>
                </tab>
                <tab name="Жизненный цикл">
                    <bookmarks> <!-- наследник от TabGroupsConfig -->
                        <tab-group name="Регистрация"> <!-- либо таб, либо разметка, вместе - нельзя -->
                            <table>
                                <tr>
                                    <td><widget id="2"/></td>  <!-- некий виджет -->
                                </tr>
                            </table>
                        </tab-group>
                        <tab-group name="Ознакомление"> <!-- либо таб, либо разметка, вместе - нельзя -->
                            <table>
                                <tr>
                                    <td><widget id="4"/></td>  <!-- некий виджет -->
                                </tr>
                            </table>
                        </tab-group>
                        <tab-group name="Исполнение"> <!-- либо таб, либо разметка, вместе - нельзя -->
                            <table>
                                <tr>
                                    <td><widget id="1"/></td>  <!-- некий виджет -->
                                </tr>
                            </table>
                        </tab-group>
                    </bookmarks>
                </tab>
            </body>
        </markup>
        <widget-config>
            <label id="1">
                <field-path/> <!-- field-path - путь относительно базового объекта, для label он не обязателен. при его наличии текст метки берётся из атрибута -->
                <text>Текст документа</text>
            </label>
            <rich-text-area id="2"> <!-- field-path - путь относительно базового объекта, для label он не обязателен -->
                <field-path value="document_text"/> <!-- путь относительно базового объекта -->
            </rich-text-area>

            <label id="2">
                <text>№</text>
            </label>
            <integer-box id="3">
                <field-path value="registration_number"/> <!-- путь относительно базового объекта -->
            </integer-box>

            <label id="4">
                <field-path value="correspondent"/>
            </label>
            <label id="5">
                <field-path value="correspondent"/>
            </label>
            <linked-domain-object-hyperlink id="5"> <!-- для единичного связанного объекта -->
                <field-path value="correspondent"/> <!-- для связанных объектов field-path обязательно должен ссылаться на поле типа reference -->
                <linked-form name="organization_default_form"/> <!-- форма, открывающаяся в модальном окне при нажатии на гиперссылку -->
                <pattern value="{name}, {short_name}"/> <!-- в паттерне ссылки задаются относительно field-path -->
            </linked-domain-object-hyperlink>

            <!-- или если есть много (1:N) связанных объектов -->
            <!-- это отдельный виджет, а не частный случай виджета с редактируемой связанной формой в таблице. последняя ограничивает нас тем, что в таблица-резюме (summary-table) ограничена лишь теми значениями, которые есть в редактируемой дочерней таблице -->
            <linked-domain-objects-table id="5">
                <field-path value="correspondent"/>
                <linked-form name="organization_default_form" inline="true"/>
                <summary-table form-name="some_form">
                    <summary-table-column header="Название">
                        <pattern value="{name}, {short_name}"/> <!-- пути задаются относительно базового field-path (correspondent) -->
                        <formatting>
                            <number-format pattern="###.####">
                                <field-paths> <!-- описание путей к полям, к которым применяется форматирование -->
                                    <field-path value="age"/>
                                    <field-path value="age"/>
                                </field-paths>
                            </number-format>
                            <date-format pattern="dd-mm-yyyy" style="short">
                                <field-paths>
                                    <field-path value="date_of_birth"/>
                                </field-paths>
                            </date-format>
                        </formatting>
                    </summary-table-column>
                    <summary-table-column header="Описание">
                        <pattern value="{correspondent.name}, {correspondent.short_name}"/>
                    </summary-table-column>
                </summary-table>
            </linked-domain-objects-table>
            <linked-domain-objects-editable-table id="5">
                <field-path value="correspondent"/>
                <linked-form name="organization_default_form" inline="true"/>
                <form-table form-name="some_form"> <!-- у этой формы базовый объект должен быть такого же типа, как correspondent -->
                    <form-table-column header="Название" widget-id="name"/>
                    <form-table-column header="Описание" widget-id="description"/>
                </form-table>
            </linked-domain-objects-editable-table>
            <template-based-widget id="77" template-name="organizations-inline-table">
                <field-path value="correspondent"/>
            </template-based-widget>
        </widget-config>
    </form>
    <widget-template name="organizations-inline-table" domain-object-type="Organization"> <!-- domain-object-type необязательный параметр. если он установлен, то field-path должен ссылаться на объект этого типа -->
        <linked-domain-objects-editable-table> <!-- Если тэг виджета находится внутри widget-template, то field-path не обязателен -->
            <!-- форма, на основании которой строится виджеты в таблице связанных объектов -->
            <!-- inline необязательный параметр, по умолчанию false (то есть в новом окне открывается). Если форма inline, то на месте текущего плагина открывается дочерний -->
            <linked-form name="organization_default_form" inline="true"/>
            <form-table form-name="some_form"> <!-- у этой формы базовый объект должен быть такого же типа, как correspondent -->
                <form-table-column header="Название" widget-id="name"/>
                <form-table-column header="Описание" widget-id="description"/>
            </form-table>
        </linked-domain-objects-editable-table>
    </widget-template>

    <form-mappings>
        <form-mapping domain-object-type="outgoing_document" form="minister_outgoing_document_form">
            <users>
                <user uid="admin"/>
            </users>
            <roles>
                <role name="Minister"/>
            </roles>
        </form-mapping>
    </form-mappings>

</configuration>