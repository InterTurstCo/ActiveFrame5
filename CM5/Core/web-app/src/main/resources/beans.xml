<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:jee="http://www.springframework.org/schema/jee"
       xsi:schemaLocation="
     http://www.springframework.org/schema/beans
     http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
     http://www.springframework.org/schema/jee
     http://www.springframework.org/schema/jee/spring-jee-3.2.xsd">

    <jee:jndi-lookup id="dataSource" jndi-name="java:jboss/datasources/CM5" />

    <bean id="dataStructureDAO"
        class="ru.intertrust.cm.core.dao.impl.PostgreSQLDataStructureDAOImpl"
        p:dataSource-ref="dataSource" />

    <bean id="configurationSerializer"
          class="ru.intertrust.cm.core.config.ConfigurationSerializer"
          p:configurationFilePath="config/domain-objects.xml"
          p:collectionsConfigurationFilePath = "config/collections.xml"
          p:configurationSchemaFilePath="config/configuration.xsd"/>

    <bean id="domainObjectConfiguration"
          class="ru.intertrust.cm.core.config.model.DomainObjectsConfiguration"
          factory-bean="configurationSerializer" factory-method="serializeDomainObjectConfiguration"/>

    <bean id="collectionsConfiguration"
          class="ru.intertrust.cm.core.config.model.CollectionsConfiguration"
          factory-bean="configurationSerializer" factory-method="serializeCollectionConfiguration"/>

    <bean id="configurationExplorer"
          class="ru.intertrust.cm.core.config.ConfigurationExplorer" init-method="init"
          p:domainObjectsConfiguration-ref="domainObjectConfiguration"
          p:collectionsConfiguration-ref="collectionsConfiguration"/>

    <bean id="configurationLoader"
          class="ru.intertrust.cm.core.business.impl.ConfigurationLoader" init-method="load"
          p:configurationService-ref="configurationService"
          p:logicalValidator-ref="domainObjectsConfigurationLogicalValidator"/>

    <bean id="domainObjectsConfigurationLogicalValidator"
          class="ru.intertrust.cm.core.config.DomainObjectsConfigurationLogicalValidator"
          p:configurationExplorer-ref="configurationExplorer"/>

    <bean id="configurationService"
        class="ru.intertrust.cm.core.business.impl.ConfigurationServiceImpl"
        p:dataStructureDAO-ref="dataStructureDAO"
        p:authenticationService-ref="authenticationService"
        p:configurationExplorer-ref="configurationExplorer"/>

    <bean id="authenticationDAO" class="ru.intertrust.cm.core.dao.impl.AuthenticationDAOImpl"
        p:dataSource-ref="dataSource" />

    <bean id="authenticationService"
        class="ru.intertrust.cm.core.business.impl.AuthenticationServiceImpl"
        p:authenticationDAO-ref="authenticationDAO" p:md5Service-ref="md5Service"
        p:crudServiceDAO-ref="crudServiceDAO" p:configurationExplorer-ref="configurationExplorer"/>

    <bean id="md5Service" class="ru.intertrust.cm.core.business.impl.MD5ServiceImpl" />

    <bean id="sequenceIdGenerator" class="ru.intertrust.cm.core.dao.impl.SequenceIdGenerator"
          p:dataSource-ref="dataSource"/>



    <bean id="crudServiceDAO" class="ru.intertrust.cm.core.dao.impl.CrudServiceDAOImpl"
         p:idGenerator-ref="sequenceIdGenerator" p:dataSource-ref="dataSource" />


    <bean id="crudService" class="ru.intertrust.cm.core.business.impl.CrudServiceImpl"
        p:crudServiceDAO-ref="crudServiceDAO"
        p:configurationExplorer-ref="configurationExplorer"/>




</beans>