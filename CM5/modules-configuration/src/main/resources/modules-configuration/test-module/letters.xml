<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<configuration xmlns="https://cm5.intertrust.ru/config">
    <domain-object-type name="letter">
        <fields>
            <string name="subject" length="128"/>
        </fields>
    </domain-object-type>

    <domain-object-type name="letter_addressee">
        <fields>
            <reference name="letter" type="letter"/>
        </fields>
    </domain-object-type>

    <domain-object-type name="organization_addressee" extends="letter_addressee">
        <fields>
            <reference name="organization" type="Organization"/>
        </fields>
    </domain-object-type>

    <domain-object-type name="department_addressee" extends="letter_addressee">
        <fields>
            <reference name="department" type="Department"/>
        </fields>
    </domain-object-type>

    <domain-object-type name="employee_addressee" extends="letter_addressee">
        <fields>
            <reference name="employee" type="Employee"/>
        </fields>
    </domain-object-type>

    <collection name="letters" idField="id">
        <prototype>
            <![CDATA[
                    select
                        l.id, l.subject, l.created_date
                    from
                        letter l
                ]]>
        </prototype>

        <counting-prototype>
            select count(*) from letter l
        </counting-prototype>
    </collection>

    <collection-view name="letters_default_view" collection="Letters" is-default="true">
        <display>
            <column field="id" name="id" type="integer" sortable="false"/>
            <column field="subject" name="Тема" editable="false" type="string" sortable="true"/>
            <column field="created_date" name="Дата" editable="false" type="string" sortable="true"/>
        </display>
    </collection-view>

    <form name="letter_form" domain-object-type="letter" is-default="true">
        <markup>
            <header>
                <table width="500px" height="200px">
                    <tr>
                        <td width="100px" h-align="right">
                            <widget id="subject_label"/>
                        </td>
                        <td width="100%" h-align="left">
                            <widget id="subject"/>
                        </td>
                    </tr>
                </table>
            </header>
            <body display-single-tab="false">
                <tab name="Главная">
                    <single-entry-group>
                        <tab-group>
                            <table>
                                <tr>
                                    <td h-align="right">
                                        <widget id="addressees_label"/>
                                    </td>
                                    <td h-align="left">
                                        <widget id="addressees"/>
                                    </td>
                                </tr>
                            </table>
                        </tab-group>
                    </single-entry-group>
                </tab>
                <tab name="Иерархический браузер">
                    <single-entry-group>
                        <tab-group>
                            <table>
                                <tr>
                                    <td>
                                        <widget width = "800px" height= "300px" id="2c"/>
                                    </td>
                                </tr>
                            </table>
                        </tab-group>
                    </single-entry-group>
                </tab>
            </body>
        </markup>
        <widget-config>
            <label id="subject_label">
                <field-path/>
                <text>Тема:</text>
            </label>
            <text-box id="subject">
                <field-path value="subject"/>
            </text-box>

            <label id="addressees_label">
                <text>Адресаты:</text>
            </label>
            <!--<list-box id="addressees">
                <field-path value="organization_addressee^letter.organization, department_addressee^letter.department, employee_addressee^letter.employee"/>
                <pattern value="{Name}"/>
            </list-box>-->
            <hierarchy-browser id="2c">
                <field-path value="organization_addressee^letter.organization, department_addressee^letter.department, employee_addressee^letter.employee"/>

                <!-- Определение списка/таблицы, выпадающего при раскрытии узла -->
                <!-- Уже выбранные элементы показываются помеченными галочками -->
                <!-- collection - название коллекции для отображения списка значений узла -->
                <node-collection-def collection="Organizations" domain-object-type="Organization">
                    <!-- название фильтра по тексту, введённому пользователем -->
                    <input-text-filter name="byName"/>
                    <!-- паттерн отображения уже выбранных значений -->
                    <selection-pattern value="{name}"/>
                    <node-collection-def collection="Departments" parent-filter="byOrganization" domain-object-type="Department">
                        <!-- название фильтра по тексту, введённому пользователем -->
                        <input-text-filter name="byName"/>
                        <!-- паттерн отображения уже выбранных значений -->
                        <selection-pattern value="{name}"/>
                        <!-- путь к узлу верхнего уровня (относительно пути этого узла) от узла данного уровня -->
                        <node-collection-def collection="Employees" parent-filter="byDepartment" domain-object-type="Employee">
                            <!-- название фильтра по тексту, введённому пользователем -->
                            <input-text-filter name="byNameAndPosition"/>
                            <!-- паттерн отображения уже выбранных значений -->
                            <selection-pattern value="{name} {position}"/>
                        </node-collection-def>
                    </node-collection-def>
                </node-collection-def>

                <!-- количество элементов, показываемых в данном узле дерева изначально -->
                <page-size>10</page-size>
                <single-choice value="true"/>
            </hierarchy-browser>
        </widget-config>
    </form>

    <form name="employee_form" domain-object-type="Employee" is-default="true">
        <markup>
            <header>
                <table width="500px" height="200px">
                    <tr>
                        <td width="100px" h-align="right">
                            <widget id="Name-Label"/>
                        </td>
                        <td width="100%" h-align="left">
                            <widget id="Name"/>
                        </td>
                        <!-- text-box (Название) -->
                    </tr>
                </table>
            </header>
            <body display-single-tab="false"> <!-- в теле - только закладки -->
                <tab name="Главная"> <!-- закладка состоит из групп с разметкой -->
                    <single-entry-group> <!-- наследник от TabGroupsConfig -->
                        <tab-group> <!-- вхождение в группу уже может содержать разметку -->
                            <table>
                                <tr>
                                    <td h-align="right">
                                        <widget id="Department-Label"/>
                                    </td>
                                    <td h-align="left">
                                        <widget id="Department"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td h-align="right">
                                        <widget id="positionLabel"/>
                                    </td>
                                    <td h-align="left">
                                        <widget id="position"/>
                                    </td>
                                </tr>
                            </table>
                        </tab-group>
                    </single-entry-group>
                </tab>
            </body>
        </markup>
        <widget-config>
            <label id="Name-Label">
                <field-path/>
                <text>Название:</text>
                <relates-to widget-id="Name"/>
            </label>
            <text-box id="Name">
                <field-path value="Name"/>
            </text-box>

            <label id="Department-Label">
                <text>Департамент:</text>
                <relates-to widget-id="Department"/>
            </label>
            <combo-box id="Department">
                <field-path value="Department"/>
                <pattern value="{Name}"/>
            </combo-box>

            <label id="positionLabel">
                <text>Должность:</text>
                <relates-to widget-id="position" />
            </label>
            <text-box id="position">
                <field-path value="Position"/>
            </text-box>
        </widget-config>
    </form>

    <form name="department_form" domain-object-type="Department" is-default="true">
        <markup>
            <header>
                <table width="500px" height="200px">
                    <tr>
                        <td width="100px" h-align="right">
                            <widget id="Name-Label"/>
                        </td>
                        <td width="100%" h-align="left">
                            <widget id="Name"/>
                        </td>
                        <!-- text-box (Название) -->
                    </tr>
                </table>
            </header>
            <body display-single-tab="false"> <!-- в теле - только закладки -->
                <tab name="Главная"> <!-- закладка состоит из групп с разметкой -->
                    <single-entry-group> <!-- наследник от TabGroupsConfig -->
                        <tab-group> <!-- вхождение в группу уже может содержать разметку -->
                            <table>
                                <tr>
                                    <td h-align="right">
                                        <widget id="Organization-Label"/>
                                    </td>
                                    <td h-align="left">
                                        <widget id="Organization"/>
                                    </td>
                                    <td h-align="left">
                                        <widget id="hyperlink"/>
                                    </td>
                                </tr>
                            </table>
                        </tab-group>
                    </single-entry-group>
                </tab>
            </body>
        </markup>
        <widget-config>
            <label id="Name-Label">
                <field-path/>
                <text>Название:</text>
                <relates-to widget-id="Name"/>
            </label>
            <text-box id="Name">
                <field-path value="Name"/>
            </text-box>

            <label id="Organization-Label">
                <text>Организация:</text>
                <relates-to widget-id="Organization"/>
            </label>
            <combo-box id="Organization">
                <field-path value="Organization"/>
                <pattern value="{Name}"/>
            </combo-box>
            <linked-domain-object-hyperlink id="hyperlink"> <!-- для единичного связанного объекта -->
                <field-path value="organization"/> <!-- для связанных объектов field-path обязательно должен ссылаться на поле типа reference -->
                <linked-form name="organization_default_form"/> <!-- форма, открывающаяся в модальном окне при нажатии на гиперссылку -->
                <pattern value="{name}"/> <!-- в паттерне ссылки задаются относительно field-path -->
            </linked-domain-object-hyperlink>
        </widget-config>
    </form>

    <form name="organization_form" domain-object-type="Organization" is-default="true">
        <markup>
            <header>
                <table width="500px" height="200px">
                    <tr>
                        <td width="100px" h-align="right">
                            <widget id="Name-Label"/>
                        </td>
                        <td width="100%" h-align="left">
                            <widget id="Name"/>
                        </td>
                        <!-- text-box (Название) -->
                    </tr>
                </table>
            </header>
            <body display-single-tab="false">
            </body>
        </markup>
        <widget-config>
            <label id="Name-Label">
                <field-path/>
                <text>Название:</text>
                <relates-to widget-id="Name" />
            </label>
            <text-box id="Name">
                <field-path value="Name"/>
            </text-box>
        </widget-config>
    </form>

</configuration>