<?xml version="1.0" encoding="UTF-8"?>
<configuration xmlns="https://cm5.intertrust.ru/config"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xsi:schemaLocation="https://cm5.intertrust.ru/config configuration.xsd">

    <notification name="NotificationAddresseeQuery">
        <notification-type name="NotificationType" priority="HIGH">
            <addressee>
                <find-person>
                    <find-query>Some SQL query {1}
                    </find-query>
                </find-person>
            </addressee>
            <triggers>
                <trigger domain-object-type="department_test" event="CREATE">
                    <config>
                        <fields>
                            <field>Name</field>
                            <field>Organization</field>
                        </fields>
                        <statuses>
                            <status>Active</status>
                            <status>Draft</status>
                        </statuses>
                    </config>
                </trigger>
                <trigger refName="TriggerChangeStatus" >
                </trigger>
            </triggers>
        </notification-type>
    </notification>

     <notification name="NotificationAddresseeClassName">
        <notification-type name="NotificationType" priority="HIGH">
            <addressee>
                <find-person>
                    <class-name>ClassName
                    </class-name>
                </find-person>
            </addressee>
            <triggers>
                <trigger refName="TriggerReadConfig" >
                </trigger>
            </triggers>
        </notification-type>
    </notification>

     <notification name="NotificationAddresseeContextRole">
        <notification-type name="NotificationType" priority="HIGH">
            <addressee>
                <by-context-role>ContextRole</by-context-role>
            </addressee>
            <triggers>
                <trigger refName="TriggerReadConfig" >
                </trigger>
            </triggers>
        </notification-type>
    </notification>

    <notification name="NotificationAddresseeDynamicGroup">
        <notification-type name="NotificationType" priority="HIGH">
            <addressee>
                <by-dynamic-group>DynamicGroup</by-dynamic-group>
            </addressee>
            <triggers>
                <trigger refName="TriggerReadConfig">
                </trigger>
            </triggers>
        </notification-type>
    </notification>
    
    <named-trigger name="TriggerReadConfig">
        <trigger domain-object-type="department_test" event="CHANGE">
            <config>
                <fields>
                    <field>Name</field>
                    <field>Organization</field>
                </fields>
                <statuses>
                    <status>Active</status>
                    <status>Draft</status>
                </statuses>
            </config>
        </trigger>
    </named-trigger>

    <named-trigger name="TriggerChangeStatus">
        <trigger domain-object-type="department_test" event="CHANGE_STATUS">
            <config>
                <fields>
                    <field>Name</field>
                    <field>Organization</field>
                </fields>
                <statuses>
                    <status>Active</status>
                    <status>Draft</status>
                </statuses>
            </config>
        </trigger>
    </named-trigger>

    <named-trigger name="Trigger2">
        <trigger domain-object-type="department_test" event="CHANGE">
            <class-name>ru.intertrust.cm.core.service.it.MyTestTrigger</class-name>
        </trigger>
    </named-trigger>

    <named-trigger name="TriggerScript">
        <trigger domain-object-type="department_test" event="CHANGE">
            <conditions-script>
            var result = ctx.get('name') + ' result';
            ctx.setResult(true);
            </conditions-script>
        </trigger>
    </named-trigger>        

    <named-trigger name="TriggerTestScript">
        <trigger domain-object-type="department_test" event="CHANGE">
            <conditions-script>
            var name = ctx.get('name');
            var findDo = session.find(ctx.get('Organization'));
            if(name == 'Department' || findDo.get('Name') == 'Organization') {
                ctx.setResult(true);
            } else {
                ctx.setResult(false);
            }          
            </conditions-script>
        </trigger>
    </named-trigger>
    
</configuration>